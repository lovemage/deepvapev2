<!DOCTYPE html>
<!-- saved from url=(0044)https://mist16888.cc/checkout.php?mode=guest -->
<html lang="zh-TW"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, maximum-scale=5.0, minimum-scale=0.5">
    <meta name="format-detection" content="telephone=no">
    <meta name="msapplication-tap-highlight" content="no">
	<title>Mist | 結帳頁面</title>
            <link rel="stylesheet" href="./Mist _ 結帳頁面_files/all.min.css">
<!-- Meta Pixel Code -->
<script async="" src="./Mist _ 結帳頁面_files/clarity.js"></script><script async="" src="./Mist _ 結帳頁面_files/oyaugvlpjg"></script><script type="text/javascript" async="" src="./Mist _ 結帳頁面_files/js"></script><script type="text/javascript" async="" src="./Mist _ 結帳頁面_files/js(1)"></script><script type="text/javascript" async="" src="./Mist _ 結帳頁面_files/js(2)"></script><script type="text/javascript" async="" src="./Mist _ 結帳頁面_files/js(3)"></script><script type="text/javascript" async="" src="./Mist _ 結帳頁面_files/js(4)"></script><script type="text/javascript" async="" src="./Mist _ 結帳頁面_files/js(5)"></script><script type="text/javascript" async="" src="./Mist _ 結帳頁面_files/js(6)"></script><script type="text/javascript" async="" src="./Mist _ 結帳頁面_files/js(7)"></script><script type="text/javascript" async="" src="./Mist _ 結帳頁面_files/js(8)"></script><script type="text/javascript" async="" src="./Mist _ 結帳頁面_files/js(9)"></script><script async="" src="./Mist _ 結帳頁面_files/gtm.js"></script><script src="./Mist _ 結帳頁面_files/3898281196984160" async=""></script><script src="./Mist _ 結帳頁面_files/2163547264137225" async=""></script><script async="" src="./Mist _ 結帳頁面_files/fbevents.js"></script><script>
!function(f,b,e,v,n,t,s)
{if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};
if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];
s.parentNode.insertBefore(t,s)}(window, document,'script',
'https://connect.facebook.net/en_US/fbevents.js');
fbq('init', '2163547264137225');
fbq('init', '3898281196984160');
fbq('track', 'PageView');
</script>

<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-NLD6HPCF');</script>
<!-- End Google Tag Manager -->

<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NLD6HPCF"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->

<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NLD6HPCF"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->

<noscript>
<img height="1" width="1" style="display:none" src="https://www.facebook.com/tr?id=2163547264137225&ev=PageView&noscript=1" />
<img height="1" width="1" style="display:none" src="https://www.facebook.com/tr?id=3898281196984160&ev=PageView&noscript=1" />
</noscript>
<!-- End Meta Pixel Code -->
    <script src="./Mist _ 結帳頁面_files/sweetalert2@11"></script><style>:root{--swal2-outline: 0 0 0 3px rgba(100, 150, 200, 0.5);--swal2-container-padding: 0.625em;--swal2-backdrop: rgba(0, 0, 0, 0.4);--swal2-backdrop-transition: background-color 0.1s;--swal2-width: 32em;--swal2-padding: 0 0 1.25em;--swal2-border: none;--swal2-border-radius: 0.3125rem;--swal2-background: white;--swal2-color: #545454;--swal2-show-animation: swal2-show 0.3s;--swal2-hide-animation: swal2-hide 0.15s forwards;--swal2-icon-zoom: 1;--swal2-icon-animations: true;--swal2-title-padding: 0.8em 1em 0;--swal2-html-container-padding: 1em 1.6em 0.3em;--swal2-input-border: 1px solid #d9d9d9;--swal2-input-border-radius: 0.1875em;--swal2-input-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.06), 0 0 0 3px transparent;--swal2-input-background: transparent;--swal2-input-transition: border-color 0.2s, box-shadow 0.2s;--swal2-input-hover-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.06), 0 0 0 3px transparent;--swal2-input-focus-border: 1px solid #b4dbed;--swal2-input-focus-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.06), 0 0 0 3px $swal2-outline-color;--swal2-progress-step-background: #add8e6;--swal2-validation-message-background: #f0f0f0;--swal2-validation-message-color: #666;--swal2-footer-border-color: #eee;--swal2-footer-background: transparent;--swal2-footer-color: inherit;--swal2-close-button-position: initial;--swal2-close-button-inset: auto;--swal2-close-button-font-size: 2.5em;--swal2-close-button-color: #ccc;--swal2-close-button-transition: color 0.2s, box-shadow 0.2s;--swal2-close-button-outline: initial;--swal2-close-button-box-shadow: inset 0 0 0 3px transparent;--swal2-close-button-focus-box-shadow: inset var(--swal2-outline);--swal2-close-button-hover-transform: none;--swal2-actions-justify-content: center;--swal2-actions-width: auto;--swal2-actions-margin: 1.25em auto 0;--swal2-actions-padding: 0;--swal2-actions-border-radius: 0;--swal2-actions-background: transparent;--swal2-action-button-transition: background-color 0.2s, box-shadow 0.2s;--swal2-action-button-hover: black 10%;--swal2-action-button-active: black 10%;--swal2-confirm-button-box-shadow: none;--swal2-confirm-button-border-radius: 0.25em;--swal2-confirm-button-background-color: #7066e0;--swal2-confirm-button-color: #fff;--swal2-deny-button-box-shadow: none;--swal2-deny-button-border-radius: 0.25em;--swal2-deny-button-background-color: #dc3741;--swal2-deny-button-color: #fff;--swal2-cancel-button-box-shadow: none;--swal2-cancel-button-border-radius: 0.25em;--swal2-cancel-button-background-color: #6e7881;--swal2-cancel-button-color: #fff;--swal2-toast-show-animation: swal2-toast-show 0.5s;--swal2-toast-hide-animation: swal2-toast-hide 0.1s forwards;--swal2-toast-border: none;--swal2-toast-box-shadow: 0 0 1px hsl(0deg 0% 0% / 0.075), 0 1px 2px hsl(0deg 0% 0% / 0.075), 1px 2px 4px hsl(0deg 0% 0% / 0.075), 1px 3px 8px hsl(0deg 0% 0% / 0.075), 2px 4px 16px hsl(0deg 0% 0% / 0.075)}[data-swal2-theme=dark]{--swal2-dark-theme-black: #19191a;--swal2-dark-theme-white: #e1e1e1;--swal2-background: var(--swal2-dark-theme-black);--swal2-color: var(--swal2-dark-theme-white);--swal2-footer-border-color: #555;--swal2-input-background: color-mix(in srgb, var(--swal2-dark-theme-black), var(--swal2-dark-theme-white) 10%);--swal2-validation-message-background: color-mix( in srgb, var(--swal2-dark-theme-black), var(--swal2-dark-theme-white) 10% );--swal2-validation-message-color: var(--swal2-dark-theme-white)}@media(prefers-color-scheme: dark){[data-swal2-theme=auto]{--swal2-dark-theme-black: #19191a;--swal2-dark-theme-white: #e1e1e1;--swal2-background: var(--swal2-dark-theme-black);--swal2-color: var(--swal2-dark-theme-white);--swal2-footer-border-color: #555;--swal2-input-background: color-mix(in srgb, var(--swal2-dark-theme-black), var(--swal2-dark-theme-white) 10%);--swal2-validation-message-background: color-mix( in srgb, var(--swal2-dark-theme-black), var(--swal2-dark-theme-white) 10% );--swal2-validation-message-color: var(--swal2-dark-theme-white)}}body.swal2-shown:not(.swal2-no-backdrop,.swal2-toast-shown){overflow:hidden}body.swal2-height-auto{height:auto !important}body.swal2-no-backdrop .swal2-container{background-color:rgba(0,0,0,0) !important;pointer-events:none}body.swal2-no-backdrop .swal2-container .swal2-popup{pointer-events:all}body.swal2-no-backdrop .swal2-container .swal2-modal{box-shadow:0 0 10px var(--swal2-backdrop)}body.swal2-toast-shown .swal2-container{box-sizing:border-box;width:360px;max-width:100%;background-color:rgba(0,0,0,0);pointer-events:none}body.swal2-toast-shown .swal2-container.swal2-top{inset:0 auto auto 50%;transform:translateX(-50%)}body.swal2-toast-shown .swal2-container.swal2-top-end,body.swal2-toast-shown .swal2-container.swal2-top-right{inset:0 0 auto auto}body.swal2-toast-shown .swal2-container.swal2-top-start,body.swal2-toast-shown .swal2-container.swal2-top-left{inset:0 auto auto 0}body.swal2-toast-shown .swal2-container.swal2-center-start,body.swal2-toast-shown .swal2-container.swal2-center-left{inset:50% auto auto 0;transform:translateY(-50%)}body.swal2-toast-shown .swal2-container.swal2-center{inset:50% auto auto 50%;transform:translate(-50%, -50%)}body.swal2-toast-shown .swal2-container.swal2-center-end,body.swal2-toast-shown .swal2-container.swal2-center-right{inset:50% 0 auto auto;transform:translateY(-50%)}body.swal2-toast-shown .swal2-container.swal2-bottom-start,body.swal2-toast-shown .swal2-container.swal2-bottom-left{inset:auto auto 0 0}body.swal2-toast-shown .swal2-container.swal2-bottom{inset:auto auto 0 50%;transform:translateX(-50%)}body.swal2-toast-shown .swal2-container.swal2-bottom-end,body.swal2-toast-shown .swal2-container.swal2-bottom-right{inset:auto 0 0 auto}@media print{body.swal2-shown:not(.swal2-no-backdrop,.swal2-toast-shown){overflow-y:scroll !important}body.swal2-shown:not(.swal2-no-backdrop,.swal2-toast-shown)>[aria-hidden=true]{display:none}body.swal2-shown:not(.swal2-no-backdrop,.swal2-toast-shown) .swal2-container{position:static !important}}div:where(.swal2-container){display:grid;position:fixed;z-index:1060;inset:0;box-sizing:border-box;grid-template-areas:"top-start     top            top-end" "center-start  center         center-end" "bottom-start  bottom-center  bottom-end";grid-template-rows:minmax(min-content, auto) minmax(min-content, auto) minmax(min-content, auto);height:100%;padding:var(--swal2-container-padding);overflow-x:hidden;transition:var(--swal2-backdrop-transition);-webkit-overflow-scrolling:touch}div:where(.swal2-container).swal2-backdrop-show,div:where(.swal2-container).swal2-noanimation{background:var(--swal2-backdrop)}div:where(.swal2-container).swal2-backdrop-hide{background:rgba(0,0,0,0) !important}div:where(.swal2-container).swal2-top-start,div:where(.swal2-container).swal2-center-start,div:where(.swal2-container).swal2-bottom-start{grid-template-columns:minmax(0, 1fr) auto auto}div:where(.swal2-container).swal2-top,div:where(.swal2-container).swal2-center,div:where(.swal2-container).swal2-bottom{grid-template-columns:auto minmax(0, 1fr) auto}div:where(.swal2-container).swal2-top-end,div:where(.swal2-container).swal2-center-end,div:where(.swal2-container).swal2-bottom-end{grid-template-columns:auto auto minmax(0, 1fr)}div:where(.swal2-container).swal2-top-start>.swal2-popup{align-self:start}div:where(.swal2-container).swal2-top>.swal2-popup{grid-column:2;place-self:start center}div:where(.swal2-container).swal2-top-end>.swal2-popup,div:where(.swal2-container).swal2-top-right>.swal2-popup{grid-column:3;place-self:start end}div:where(.swal2-container).swal2-center-start>.swal2-popup,div:where(.swal2-container).swal2-center-left>.swal2-popup{grid-row:2;align-self:center}div:where(.swal2-container).swal2-center>.swal2-popup{grid-column:2;grid-row:2;place-self:center center}div:where(.swal2-container).swal2-center-end>.swal2-popup,div:where(.swal2-container).swal2-center-right>.swal2-popup{grid-column:3;grid-row:2;place-self:center end}div:where(.swal2-container).swal2-bottom-start>.swal2-popup,div:where(.swal2-container).swal2-bottom-left>.swal2-popup{grid-column:1;grid-row:3;align-self:end}div:where(.swal2-container).swal2-bottom>.swal2-popup{grid-column:2;grid-row:3;place-self:end center}div:where(.swal2-container).swal2-bottom-end>.swal2-popup,div:where(.swal2-container).swal2-bottom-right>.swal2-popup{grid-column:3;grid-row:3;place-self:end end}div:where(.swal2-container).swal2-grow-row>.swal2-popup,div:where(.swal2-container).swal2-grow-fullscreen>.swal2-popup{grid-column:1/4;width:100%}div:where(.swal2-container).swal2-grow-column>.swal2-popup,div:where(.swal2-container).swal2-grow-fullscreen>.swal2-popup{grid-row:1/4;align-self:stretch}div:where(.swal2-container).swal2-no-transition{transition:none !important}div:where(.swal2-container)[popover]{width:auto;border:0}div:where(.swal2-container) div:where(.swal2-popup){display:none;position:relative;box-sizing:border-box;grid-template-columns:minmax(0, 100%);width:var(--swal2-width);max-width:100%;padding:var(--swal2-padding);border:var(--swal2-border);border-radius:var(--swal2-border-radius);background:var(--swal2-background);color:var(--swal2-color);font-family:inherit;font-size:1rem;container-name:swal2-popup}div:where(.swal2-container) div:where(.swal2-popup):focus{outline:none}div:where(.swal2-container) div:where(.swal2-popup).swal2-loading{overflow-y:hidden}div:where(.swal2-container) div:where(.swal2-popup).swal2-draggable{cursor:grab}div:where(.swal2-container) div:where(.swal2-popup).swal2-draggable div:where(.swal2-icon){cursor:grab}div:where(.swal2-container) div:where(.swal2-popup).swal2-dragging{cursor:grabbing}div:where(.swal2-container) div:where(.swal2-popup).swal2-dragging div:where(.swal2-icon){cursor:grabbing}div:where(.swal2-container) h2:where(.swal2-title){position:relative;max-width:100%;margin:0;padding:var(--swal2-title-padding);color:inherit;font-size:1.875em;font-weight:600;text-align:center;text-transform:none;word-wrap:break-word;cursor:initial}div:where(.swal2-container) div:where(.swal2-actions){display:flex;z-index:1;box-sizing:border-box;flex-wrap:wrap;align-items:center;justify-content:var(--swal2-actions-justify-content);width:var(--swal2-actions-width);margin:var(--swal2-actions-margin);padding:var(--swal2-actions-padding);border-radius:var(--swal2-actions-border-radius);background:var(--swal2-actions-background)}div:where(.swal2-container) div:where(.swal2-loader){display:none;align-items:center;justify-content:center;width:2.2em;height:2.2em;margin:0 1.875em;animation:swal2-rotate-loading 1.5s linear 0s infinite normal;border-width:.25em;border-style:solid;border-radius:100%;border-color:#2778c4 rgba(0,0,0,0) #2778c4 rgba(0,0,0,0)}div:where(.swal2-container) button:where(.swal2-styled){margin:.3125em;padding:.625em 1.1em;transition:var(--swal2-action-button-transition);border:none;box-shadow:0 0 0 3px rgba(0,0,0,0);font-weight:500}div:where(.swal2-container) button:where(.swal2-styled):not([disabled]){cursor:pointer}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-confirm){border-radius:var(--swal2-confirm-button-border-radius);background:initial;background-color:var(--swal2-confirm-button-background-color);box-shadow:var(--swal2-confirm-button-box-shadow);color:var(--swal2-confirm-button-color);font-size:1em}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-confirm):hover{background-color:color-mix(in srgb, var(--swal2-confirm-button-background-color), var(--swal2-action-button-hover))}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-confirm):active{background-color:color-mix(in srgb, var(--swal2-confirm-button-background-color), var(--swal2-action-button-active))}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-deny){border-radius:var(--swal2-deny-button-border-radius);background:initial;background-color:var(--swal2-deny-button-background-color);box-shadow:var(--swal2-deny-button-box-shadow);color:var(--swal2-deny-button-color);font-size:1em}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-deny):hover{background-color:color-mix(in srgb, var(--swal2-deny-button-background-color), var(--swal2-action-button-hover))}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-deny):active{background-color:color-mix(in srgb, var(--swal2-deny-button-background-color), var(--swal2-action-button-active))}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-cancel){border-radius:var(--swal2-cancel-button-border-radius);background:initial;background-color:var(--swal2-cancel-button-background-color);box-shadow:var(--swal2-cancel-button-box-shadow);color:var(--swal2-cancel-button-color);font-size:1em}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-cancel):hover{background-color:color-mix(in srgb, var(--swal2-cancel-button-background-color), var(--swal2-action-button-hover))}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-cancel):active{background-color:color-mix(in srgb, var(--swal2-cancel-button-background-color), var(--swal2-action-button-active))}div:where(.swal2-container) button:where(.swal2-styled):focus-visible{outline:none;box-shadow:var(--swal2-action-button-focus-box-shadow)}div:where(.swal2-container) button:where(.swal2-styled)[disabled]:not(.swal2-loading){opacity:.4}div:where(.swal2-container) button:where(.swal2-styled)::-moz-focus-inner{border:0}div:where(.swal2-container) div:where(.swal2-footer){margin:1em 0 0;padding:1em 1em 0;border-top:1px solid var(--swal2-footer-border-color);background:var(--swal2-footer-background);color:var(--swal2-footer-color);font-size:1em;text-align:center;cursor:initial}div:where(.swal2-container) .swal2-timer-progress-bar-container{position:absolute;right:0;bottom:0;left:0;grid-column:auto !important;overflow:hidden;border-bottom-right-radius:var(--swal2-border-radius);border-bottom-left-radius:var(--swal2-border-radius)}div:where(.swal2-container) div:where(.swal2-timer-progress-bar){width:100%;height:.25em;background:rgba(0,0,0,.2)}div:where(.swal2-container) img:where(.swal2-image){max-width:100%;margin:2em auto 1em;cursor:initial}div:where(.swal2-container) button:where(.swal2-close){position:var(--swal2-close-button-position);inset:var(--swal2-close-button-inset);z-index:2;align-items:center;justify-content:center;width:1.2em;height:1.2em;margin-top:0;margin-right:0;margin-bottom:-1.2em;padding:0;overflow:hidden;transition:var(--swal2-close-button-transition);border:none;border-radius:var(--swal2-border-radius);outline:var(--swal2-close-button-outline);background:rgba(0,0,0,0);color:var(--swal2-close-button-color);font-family:monospace;font-size:var(--swal2-close-button-font-size);cursor:pointer;justify-self:end}div:where(.swal2-container) button:where(.swal2-close):hover{transform:var(--swal2-close-button-hover-transform);background:rgba(0,0,0,0);color:#f27474}div:where(.swal2-container) button:where(.swal2-close):focus-visible{outline:none;box-shadow:var(--swal2-close-button-focus-box-shadow)}div:where(.swal2-container) button:where(.swal2-close)::-moz-focus-inner{border:0}div:where(.swal2-container) div:where(.swal2-html-container){z-index:1;justify-content:center;margin:0;padding:var(--swal2-html-container-padding);overflow:auto;color:inherit;font-size:1.125em;font-weight:normal;line-height:normal;text-align:center;word-wrap:break-word;word-break:break-word;cursor:initial}div:where(.swal2-container) input:where(.swal2-input),div:where(.swal2-container) input:where(.swal2-file),div:where(.swal2-container) textarea:where(.swal2-textarea),div:where(.swal2-container) select:where(.swal2-select),div:where(.swal2-container) div:where(.swal2-radio),div:where(.swal2-container) label:where(.swal2-checkbox){margin:1em 2em 3px}div:where(.swal2-container) input:where(.swal2-input),div:where(.swal2-container) input:where(.swal2-file),div:where(.swal2-container) textarea:where(.swal2-textarea){box-sizing:border-box;width:auto;transition:var(--swal2-input-transition);border:var(--swal2-input-border);border-radius:var(--swal2-input-border-radius);background:var(--swal2-input-background);box-shadow:var(--swal2-input-box-shadow);color:inherit;font-size:1.125em}div:where(.swal2-container) input:where(.swal2-input).swal2-inputerror,div:where(.swal2-container) input:where(.swal2-file).swal2-inputerror,div:where(.swal2-container) textarea:where(.swal2-textarea).swal2-inputerror{border-color:#f27474 !important;box-shadow:0 0 2px #f27474 !important}div:where(.swal2-container) input:where(.swal2-input):hover,div:where(.swal2-container) input:where(.swal2-file):hover,div:where(.swal2-container) textarea:where(.swal2-textarea):hover{box-shadow:var(--swal2-input-hover-box-shadow)}div:where(.swal2-container) input:where(.swal2-input):focus,div:where(.swal2-container) input:where(.swal2-file):focus,div:where(.swal2-container) textarea:where(.swal2-textarea):focus{border:var(--swal2-input-focus-border);outline:none;box-shadow:var(--swal2-input-focus-box-shadow)}div:where(.swal2-container) input:where(.swal2-input)::placeholder,div:where(.swal2-container) input:where(.swal2-file)::placeholder,div:where(.swal2-container) textarea:where(.swal2-textarea)::placeholder{color:#ccc}div:where(.swal2-container) .swal2-range{margin:1em 2em 3px;background:var(--swal2-background)}div:where(.swal2-container) .swal2-range input{width:80%}div:where(.swal2-container) .swal2-range output{width:20%;color:inherit;font-weight:600;text-align:center}div:where(.swal2-container) .swal2-range input,div:where(.swal2-container) .swal2-range output{height:2.625em;padding:0;font-size:1.125em;line-height:2.625em}div:where(.swal2-container) .swal2-input{height:2.625em;padding:0 .75em}div:where(.swal2-container) .swal2-file{width:75%;margin-right:auto;margin-left:auto;background:var(--swal2-input-background);font-size:1.125em}div:where(.swal2-container) .swal2-textarea{height:6.75em;padding:.75em}div:where(.swal2-container) .swal2-select{min-width:50%;max-width:100%;padding:.375em .625em;background:var(--swal2-input-background);color:inherit;font-size:1.125em}div:where(.swal2-container) .swal2-radio,div:where(.swal2-container) .swal2-checkbox{align-items:center;justify-content:center;background:var(--swal2-background);color:inherit}div:where(.swal2-container) .swal2-radio label,div:where(.swal2-container) .swal2-checkbox label{margin:0 .6em;font-size:1.125em}div:where(.swal2-container) .swal2-radio input,div:where(.swal2-container) .swal2-checkbox input{flex-shrink:0;margin:0 .4em}div:where(.swal2-container) label:where(.swal2-input-label){display:flex;justify-content:center;margin:1em auto 0}div:where(.swal2-container) div:where(.swal2-validation-message){align-items:center;justify-content:center;margin:1em 0 0;padding:.625em;overflow:hidden;background:var(--swal2-validation-message-background);color:var(--swal2-validation-message-color);font-size:1em;font-weight:300}div:where(.swal2-container) div:where(.swal2-validation-message)::before{content:"!";display:inline-block;width:1.5em;min-width:1.5em;height:1.5em;margin:0 .625em;border-radius:50%;background-color:#f27474;color:#fff;font-weight:600;line-height:1.5em;text-align:center}div:where(.swal2-container) .swal2-progress-steps{flex-wrap:wrap;align-items:center;max-width:100%;margin:1.25em auto;padding:0;background:rgba(0,0,0,0);font-weight:600}div:where(.swal2-container) .swal2-progress-steps li{display:inline-block;position:relative}div:where(.swal2-container) .swal2-progress-steps .swal2-progress-step{z-index:20;flex-shrink:0;width:2em;height:2em;border-radius:2em;background:#2778c4;color:#fff;line-height:2em;text-align:center}div:where(.swal2-container) .swal2-progress-steps .swal2-progress-step.swal2-active-progress-step{background:#2778c4}div:where(.swal2-container) .swal2-progress-steps .swal2-progress-step.swal2-active-progress-step~.swal2-progress-step{background:var(--swal2-progress-step-background);color:#fff}div:where(.swal2-container) .swal2-progress-steps .swal2-progress-step.swal2-active-progress-step~.swal2-progress-step-line{background:var(--swal2-progress-step-background)}div:where(.swal2-container) .swal2-progress-steps .swal2-progress-step-line{z-index:10;flex-shrink:0;width:2.5em;height:.4em;margin:0 -1px;background:#2778c4}div:where(.swal2-icon){position:relative;box-sizing:content-box;justify-content:center;width:5em;height:5em;margin:2.5em auto .6em;zoom:var(--swal2-icon-zoom);border:.25em solid rgba(0,0,0,0);border-radius:50%;border-color:#000;font-family:inherit;line-height:5em;cursor:default;user-select:none}div:where(.swal2-icon) .swal2-icon-content{display:flex;align-items:center;font-size:3.75em}div:where(.swal2-icon).swal2-error{border-color:#f27474;color:#f27474}div:where(.swal2-icon).swal2-error .swal2-x-mark{position:relative;flex-grow:1}div:where(.swal2-icon).swal2-error [class^=swal2-x-mark-line]{display:block;position:absolute;top:2.3125em;width:2.9375em;height:.3125em;border-radius:.125em;background-color:#f27474}div:where(.swal2-icon).swal2-error [class^=swal2-x-mark-line][class$=left]{left:1.0625em;transform:rotate(45deg)}div:where(.swal2-icon).swal2-error [class^=swal2-x-mark-line][class$=right]{right:1em;transform:rotate(-45deg)}@container swal2-popup style(--swal2-icon-animations:true){div:where(.swal2-icon).swal2-error.swal2-icon-show{animation:swal2-animate-error-icon .5s}div:where(.swal2-icon).swal2-error.swal2-icon-show .swal2-x-mark{animation:swal2-animate-error-x-mark .5s}}div:where(.swal2-icon).swal2-warning{border-color:#f8bb86;color:#f8bb86}@container swal2-popup style(--swal2-icon-animations:true){div:where(.swal2-icon).swal2-warning.swal2-icon-show{animation:swal2-animate-error-icon .5s}div:where(.swal2-icon).swal2-warning.swal2-icon-show .swal2-icon-content{animation:swal2-animate-i-mark .5s}}div:where(.swal2-icon).swal2-info{border-color:#3fc3ee;color:#3fc3ee}@container swal2-popup style(--swal2-icon-animations:true){div:where(.swal2-icon).swal2-info.swal2-icon-show{animation:swal2-animate-error-icon .5s}div:where(.swal2-icon).swal2-info.swal2-icon-show .swal2-icon-content{animation:swal2-animate-i-mark .8s}}div:where(.swal2-icon).swal2-question{border-color:#87adbd;color:#87adbd}@container swal2-popup style(--swal2-icon-animations:true){div:where(.swal2-icon).swal2-question.swal2-icon-show{animation:swal2-animate-error-icon .5s}div:where(.swal2-icon).swal2-question.swal2-icon-show .swal2-icon-content{animation:swal2-animate-question-mark .8s}}div:where(.swal2-icon).swal2-success{border-color:#a5dc86;color:#a5dc86}div:where(.swal2-icon).swal2-success [class^=swal2-success-circular-line]{position:absolute;width:3.75em;height:7.5em;border-radius:50%}div:where(.swal2-icon).swal2-success [class^=swal2-success-circular-line][class$=left]{top:-0.4375em;left:-2.0635em;transform:rotate(-45deg);transform-origin:3.75em 3.75em;border-radius:7.5em 0 0 7.5em}div:where(.swal2-icon).swal2-success [class^=swal2-success-circular-line][class$=right]{top:-0.6875em;left:1.875em;transform:rotate(-45deg);transform-origin:0 3.75em;border-radius:0 7.5em 7.5em 0}div:where(.swal2-icon).swal2-success .swal2-success-ring{position:absolute;z-index:2;top:-0.25em;left:-0.25em;box-sizing:content-box;width:100%;height:100%;border:.25em solid rgba(165,220,134,.3);border-radius:50%}div:where(.swal2-icon).swal2-success .swal2-success-fix{position:absolute;z-index:1;top:.5em;left:1.625em;width:.4375em;height:5.625em;transform:rotate(-45deg)}div:where(.swal2-icon).swal2-success [class^=swal2-success-line]{display:block;position:absolute;z-index:2;height:.3125em;border-radius:.125em;background-color:#a5dc86}div:where(.swal2-icon).swal2-success [class^=swal2-success-line][class$=tip]{top:2.875em;left:.8125em;width:1.5625em;transform:rotate(45deg)}div:where(.swal2-icon).swal2-success [class^=swal2-success-line][class$=long]{top:2.375em;right:.5em;width:2.9375em;transform:rotate(-45deg)}@container swal2-popup style(--swal2-icon-animations:true){div:where(.swal2-icon).swal2-success.swal2-icon-show .swal2-success-line-tip{animation:swal2-animate-success-line-tip .75s}div:where(.swal2-icon).swal2-success.swal2-icon-show .swal2-success-line-long{animation:swal2-animate-success-line-long .75s}div:where(.swal2-icon).swal2-success.swal2-icon-show .swal2-success-circular-line-right{animation:swal2-rotate-success-circular-line 4.25s ease-in}}[class^=swal2]{-webkit-tap-highlight-color:rgba(0,0,0,0)}.swal2-show{animation:var(--swal2-show-animation)}.swal2-hide{animation:var(--swal2-hide-animation)}.swal2-noanimation{transition:none}.swal2-scrollbar-measure{position:absolute;top:-9999px;width:50px;height:50px;overflow:scroll}.swal2-rtl .swal2-close{margin-right:initial;margin-left:0}.swal2-rtl .swal2-timer-progress-bar{right:0;left:auto}.swal2-toast{box-sizing:border-box;grid-column:1/4 !important;grid-row:1/4 !important;grid-template-columns:min-content auto min-content;padding:1em;overflow-y:hidden;border:var(--swal2-toast-border);background:var(--swal2-background);box-shadow:var(--swal2-toast-box-shadow);pointer-events:all}.swal2-toast>*{grid-column:2}.swal2-toast h2:where(.swal2-title){margin:.5em 1em;padding:0;font-size:1em;text-align:initial}.swal2-toast .swal2-loading{justify-content:center}.swal2-toast input:where(.swal2-input){height:2em;margin:.5em;font-size:1em}.swal2-toast .swal2-validation-message{font-size:1em}.swal2-toast div:where(.swal2-footer){margin:.5em 0 0;padding:.5em 0 0;font-size:.8em}.swal2-toast button:where(.swal2-close){grid-column:3/3;grid-row:1/99;align-self:center;width:.8em;height:.8em;margin:0;font-size:2em}.swal2-toast div:where(.swal2-html-container){margin:.5em 1em;padding:0;overflow:initial;font-size:1em;text-align:initial}.swal2-toast div:where(.swal2-html-container):empty{padding:0}.swal2-toast .swal2-loader{grid-column:1;grid-row:1/99;align-self:center;width:2em;height:2em;margin:.25em}.swal2-toast .swal2-icon{grid-column:1;grid-row:1/99;align-self:center;width:2em;min-width:2em;height:2em;margin:0 .5em 0 0}.swal2-toast .swal2-icon .swal2-icon-content{display:flex;align-items:center;font-size:1.8em;font-weight:bold}.swal2-toast .swal2-icon.swal2-success .swal2-success-ring{width:2em;height:2em}.swal2-toast .swal2-icon.swal2-error [class^=swal2-x-mark-line]{top:.875em;width:1.375em}.swal2-toast .swal2-icon.swal2-error [class^=swal2-x-mark-line][class$=left]{left:.3125em}.swal2-toast .swal2-icon.swal2-error [class^=swal2-x-mark-line][class$=right]{right:.3125em}.swal2-toast div:where(.swal2-actions){justify-content:flex-start;height:auto;margin:0;margin-top:.5em;padding:0 .5em}.swal2-toast button:where(.swal2-styled){margin:.25em .5em;padding:.4em .6em;font-size:1em}.swal2-toast .swal2-success{border-color:#a5dc86}.swal2-toast .swal2-success [class^=swal2-success-circular-line]{position:absolute;width:1.6em;height:3em;border-radius:50%}.swal2-toast .swal2-success [class^=swal2-success-circular-line][class$=left]{top:-0.8em;left:-0.5em;transform:rotate(-45deg);transform-origin:2em 2em;border-radius:4em 0 0 4em}.swal2-toast .swal2-success [class^=swal2-success-circular-line][class$=right]{top:-0.25em;left:.9375em;transform-origin:0 1.5em;border-radius:0 4em 4em 0}.swal2-toast .swal2-success .swal2-success-ring{width:2em;height:2em}.swal2-toast .swal2-success .swal2-success-fix{top:0;left:.4375em;width:.4375em;height:2.6875em}.swal2-toast .swal2-success [class^=swal2-success-line]{height:.3125em}.swal2-toast .swal2-success [class^=swal2-success-line][class$=tip]{top:1.125em;left:.1875em;width:.75em}.swal2-toast .swal2-success [class^=swal2-success-line][class$=long]{top:.9375em;right:.1875em;width:1.375em}@container swal2-popup style(--swal2-icon-animations:true){.swal2-toast .swal2-success.swal2-icon-show .swal2-success-line-tip{animation:swal2-toast-animate-success-line-tip .75s}.swal2-toast .swal2-success.swal2-icon-show .swal2-success-line-long{animation:swal2-toast-animate-success-line-long .75s}}.swal2-toast.swal2-show{animation:var(--swal2-toast-show-animation)}.swal2-toast.swal2-hide{animation:var(--swal2-toast-hide-animation)}@keyframes swal2-show{0%{transform:scale(0.7)}45%{transform:scale(1.05)}80%{transform:scale(0.95)}100%{transform:scale(1)}}@keyframes swal2-hide{0%{transform:scale(1);opacity:1}100%{transform:scale(0.5);opacity:0}}@keyframes swal2-animate-success-line-tip{0%{top:1.1875em;left:.0625em;width:0}54%{top:1.0625em;left:.125em;width:0}70%{top:2.1875em;left:-0.375em;width:3.125em}84%{top:3em;left:1.3125em;width:1.0625em}100%{top:2.8125em;left:.8125em;width:1.5625em}}@keyframes swal2-animate-success-line-long{0%{top:3.375em;right:2.875em;width:0}65%{top:3.375em;right:2.875em;width:0}84%{top:2.1875em;right:0;width:3.4375em}100%{top:2.375em;right:.5em;width:2.9375em}}@keyframes swal2-rotate-success-circular-line{0%{transform:rotate(-45deg)}5%{transform:rotate(-45deg)}12%{transform:rotate(-405deg)}100%{transform:rotate(-405deg)}}@keyframes swal2-animate-error-x-mark{0%{margin-top:1.625em;transform:scale(0.4);opacity:0}50%{margin-top:1.625em;transform:scale(0.4);opacity:0}80%{margin-top:-0.375em;transform:scale(1.15)}100%{margin-top:0;transform:scale(1);opacity:1}}@keyframes swal2-animate-error-icon{0%{transform:rotateX(100deg);opacity:0}100%{transform:rotateX(0deg);opacity:1}}@keyframes swal2-rotate-loading{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}@keyframes swal2-animate-question-mark{0%{transform:rotateY(-360deg)}100%{transform:rotateY(0)}}@keyframes swal2-animate-i-mark{0%{transform:rotateZ(45deg);opacity:0}25%{transform:rotateZ(-25deg);opacity:.4}50%{transform:rotateZ(15deg);opacity:.8}75%{transform:rotateZ(-5deg);opacity:1}100%{transform:rotateX(0);opacity:1}}@keyframes swal2-toast-show{0%{transform:translateY(-0.625em) rotateZ(2deg)}33%{transform:translateY(0) rotateZ(-2deg)}66%{transform:translateY(0.3125em) rotateZ(2deg)}100%{transform:translateY(0) rotateZ(0deg)}}@keyframes swal2-toast-hide{100%{transform:rotateZ(1deg);opacity:0}}@keyframes swal2-toast-animate-success-line-tip{0%{top:.5625em;left:.0625em;width:0}54%{top:.125em;left:.125em;width:0}70%{top:.625em;left:-0.25em;width:1.625em}84%{top:1.0625em;left:.75em;width:.5em}100%{top:1.125em;left:.1875em;width:.75em}}@keyframes swal2-toast-animate-success-line-long{0%{top:1.625em;right:1.375em;width:0}65%{top:1.25em;right:.9375em;width:0}84%{top:.9375em;right:0;width:1.125em}100%{top:.9375em;right:.1875em;width:1.375em}}</style>
    <style>
        /* 使用與 index.php 相同的 CSS 變量 */
        :root {
            --primary-color: #4A6741;
            --secondary-color: #94A68F;
            --tertiary-color: #B8C5B0;
            --accent-color: #F3D391;
            --accent-secondary: #E9967A;
            --background-color: #F8F6F0;
            --gray-color: #EDEAE5;
            --text-color: #4A6741;
            --light-gray: #F5F5F5;
            --border-color: #E8E8E8;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background-color: #FFFFFF !important; /* 純白色背景 */
            color: #333333 !important; /* 深灰色文字 */
        }

        /* 頂部導航欄 */
        .header {
            background-color: #FFFFFF !important; /* 純白色背景 */
            padding: 0.5rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1) !important;
            position: sticky;
            top: 0;
            z-index: 100;
            height: 90px;
        }

        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 0 3rem;
            height: 100%;
            background-color: #FFFFFF !important; /* 純白色背景 */
        }

        .logo {
            height: 250px;
            width: auto;
            display: block;
            margin: 0 auto;
            object-fit: contain;
            max-width: 300px;
        }

        /* 結帳頁面主容器 */
        .checkout-container {
            max-width: 800px;
            margin: 2rem auto;
            padding: 0 1rem;
            background-color: transparent !important;
        }

        /* 結帳步驟指示器 */
        .checkout-steps {
            display: flex !important;
            justify-content: space-between !important;
            background: linear-gradient(to bottom, #4c4d52, #222222) !important;
            color: #fce1bd !important;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3) !important;
            border-radius: 8px !important;
            padding: 1.2rem !important;
            margin-bottom: 2rem;
            border: 1px solid rgba(252, 229, 193, 0.3) !important;
        }

        .step {
            display: flex !important;
            align-items: center !important;
            color: rgba(252, 229, 193, 0.7) !important;
            opacity: 1;
        }

        .step i {
            color: #fce1bd !important; /* 金色圖標 */
            font-size: 1.2rem;
            margin-right: 0.5rem;
        }

        .step.active {
            color: #fce1bd !important; /* 亮金色文字 */
            font-weight: bold !important;
            text-shadow: 0 0 5px rgba(252, 229, 193, 0.3) !important; /* 文字光暈效果 */
        }

        .step.active i {
            color: #fce1bd !important; /* 亮金色圖標 */
            text-shadow: 0 0 8px rgba(252, 229, 193, 0.5) !important; /* 圖標光暈效果 */
        }

        /* 訂單摘要 */
        .order-summary {
            background: #FFFFFF !important;
            color: #333333 !important;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1) !important;
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        .summary-title {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 1rem;
            color: #333333 !important;
            border-bottom: 1px solid #E8E8E8 !important;
            padding-bottom: 10px !important;
        }

        .cart-items {
            margin-bottom: 1.5rem;
        }

        /* 購物車商品樣式優化 */
        .cart-item {
            display: flex;
            padding: 1.5rem;
            background: #FFFFFF !important;
            border: 1px solid #E8E8E8 !important;
            border-radius: 12px;
            margin-bottom: 1rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05) !important;
            transition: all 0.3s ease;
        }

        .cart-item:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            transform: translateY(-2px);
        }

        .item-image {
            width: 100px;
            height: 100px;
            object-fit: cover;
            border-radius: 8px;
            margin-right: 1.5rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .item-details {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .item-name {
            font-size: 1.2rem;
            font-weight: 700;
            color: #333333 !important;
            margin-bottom: 0.5rem;
        }

        .cart-discount-title {
            color: #E9967A;
            font-size: 1.2rem;
            margin-bottom: 0.8rem;
            font-weight: 500;
            background: rgba(233, 150, 122, 0.1);
            padding: 0.4rem 0.8rem;
            border-radius: 4px;
            display: inline-block;
            margin-bottom: 1rem;
        }

        .item-option {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.8rem 1rem;
            background: #F5F5F5 !important;
            color: #333333 !important;
            border-radius: 0;
            margin-bottom: 1px;
        }

        .item-option-name {
            flex: 1;
            font-weight: 500;
            color: #333333 !important;
        }

        /* 修正數量顯示顏色問題 */
        .item-option-quantity {
            color: #333333 !important; /* 改為金色文字 */
            font-weight: 500;
            background: #FFFFFF !important; /* 改為深灰色背景 */
            padding: 0.4rem 1rem;
            border-radius: 30px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.2);
            min-width: 60px;
            text-align: center;
            border: 1px solid #E8E8E8 !important;
        }

        .item-subtotal {
            margin-top: 1rem;
            text-align: right;
            font-weight: 600;
            color: #333333 !important;
            border-top: 1px solid #E8E8E8 !important;
            padding-top: 1rem;
            display: flex;
            justify-content: flex-end;
            align-items: center;
        }

        .item-price {
            font-size: 1.2rem;
            margin-left: 0.5rem;
            color: #4c4d52 !important;
            font-weight: 700;
        }

        /* 表單樣式 */
        .form-section {
            background: #FFFFFF !important;
            color: #333333 !important;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1) !important;
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            color: #333333 !important;
            font-weight: 500;
        }

        .form-input {
            width: 100%;
            padding: 0.8rem;
            background: #FFFFFF !important;
            color: #333333 !important;
            border: 1px solid #E8E8E8 !important;
            border-radius: 8px;
            font-size: 1rem;
        }

        .form-input:focus {
            outline: none !important;
            border-color: #4A6741 !important;
        }

        /* 按鈕樣式 */
        .submit-button {
            background: linear-gradient(to bottom, #4c4d52, #222222) !important; /* 深色漸層背景 */
            color: #fce1bd !important; /* 金色文字 */
            border: none !important;
            padding: 1rem 2rem;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: bold !important;
            cursor: pointer;
            width: 100%;
            transition: all 0.3s ease;
        }

        .submit-button:hover {
            background: linear-gradient(to bottom, #3a3b40, #1a1a1a) !important; /* 稍微暗一點的漸層 */
            transform: translateY(-2px) !important;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2) !important;
        }

        /* 響應式設計 */
        @media (max-width: 768px) {
            .checkout-steps {
                font-size: 0.9rem;
                padding: 0.8rem;
            }

            .cart-item {
                flex-direction: column;
                padding: 1rem;
            }
            
            .item-image {
                width: 100%;
                height: 180px;
                margin-right: 0;
                margin-bottom: 1rem;
            }
            
            .item-option {
                display: grid;
                grid-template-columns: 1.5fr 0.75fr 0.75fr;
                padding: 0.6rem;
                font-size: 0.85rem;
            }
            
            .item-option-name {
                font-size: 0.95rem;
                min-width: auto;
                padding-right: 0.5rem;
            }
            
            .item-option-quantity {
                font-size: 0.95rem;
                min-width: auto;
                margin-top: 0;
            }
            
            .item-option-price {
                font-size: 0.95rem;
                min-width: auto;
                margin-right: 30px; /* 向左移動30px */
                position: relative;
                right: 30px; /* 額外向左偏移 */
            }
        }

        /* 修改商品選項和總計的樣式 */
        .item-options {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }

        .item-option {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr;  /* 三列固定比例：名稱、數量、單價 */
            align-items: center;
            padding: 0.8rem;
            background: var(--light-gray);
            border-radius: 8px;
            font-size: 0.9rem;
        }

        /* 規格名稱 */
        .item-option-name {
            min-width: 120px;  /* 最小寬度 */
            font-size: 1.1rem;
            padding-right: 1rem;
            font-weight: 600; /* 添加粗體 */
            color: var(--primary-color); /* 添加與小計相同的顏色 */
        }

        /* 數量 */
        .item-option-quantity {
            text-align: center;
            font-size: 1.1rem;
            min-width: 80px;  /* 最小寬度 */
            font-weight: 600; /* 添加粗體 */
            color: var(--primary-color); /* 添加與小計相同的顏色 */
        }

        /* 單價 */
        .item-option-price {
            text-align: right;
            font-weight: 600;
            font-size: 1.1rem;
            color: #4c4d52;
            min-width: 80px;  /* 最小寬度 */
        }

        /* 小計 */
        .item-option-subtotal {
            text-align: right;
            font-weight: 700; /* 增加粗體程度 */
            font-size: 1.1rem;
            color: var(--primary-color);
            min-width: 100px;  /* 最小寬度 */
        }

        /* 總計區域美化 */
        .total-summary {
            background: #FFFFFF !important;
            color: #4c4d52 !important;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1) !important;
            border-radius: 12px;
            padding: 1.5rem;
        }

        .total-row {
            display: flex;
            justify-content: space-between;
            padding: 0.8rem 0;
            border-bottom: 1px dashed #E8E8E8 !important;
        }

        .total-row:last-child {
            border-bottom: none;
        }

        .total-final {
            margin-top: 0.5rem;
            padding-top: 1rem;
            border-top: 2px solid #4A6741 !important;
            font-size: 1.3rem;
            color: #4c4d52 !important;
        }

        /* 運費提示 */
        .shipping-notice {
            font-size: 0.9rem;
            color: #333333 !important;
            text-align: right;
            margin-top: 0.5rem;
            opacity: 0.8;
        }

        /* 配送方式區塊 */
        .checkout-section {
            background: #FFFFFF !important;
            color: #333333 !important;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1) !important;
            margin-bottom: 2rem !important;
            border-radius: 12px !important;
            padding: 1.5rem !important;
        }

        .section-title {
            color: #4c4d52 !important;
            border-bottom: 1px solid #4c4d52 !important;
            padding-bottom: 10px !important;
            margin-bottom: 1.5rem !important;
            font-size: 1.2rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .section-title i {
            color: #4c4d52;
            font-size: 1.3rem;
        }

        /* 配送方式選擇 */
        .shipping-method {
            background: #4c4d52 !important;
            color: #4c4d52 !important;
            border: 1px solid #E8E8E8 !important;
            border-radius: 8px !important;
            padding: 1rem !important;
            margin-bottom: 1rem !important;
            display: flex;
            align-items: center;
            gap: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .shipping-method:hover {
            background: rgba(74, 103, 65, 0.05);
            border-color: var(--primary-color);
            transform: translateY(-2px);
        }

        .shipping-method.active {
            background: rgba(252, 229, 193, 0.1) !important;
            border-color: #FCE5C1 !important;
        }

        .shipping-method.active::after {
            content: '✓';
            position: absolute;
            top: 1rem;
            right: 1rem;
            color: #FCE5C1 !important;
            font-size: 1.2rem;
            font-weight: bold;
        }

        .method-icon {
            width: 40px;
            height: 40px;
            background: #4c4d52 !important;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .method-icon i {
            color: white;
            font-size: 1.2rem;
        }

        .method-info {
            flex: 1;
        }

        .method-name {
            font-weight: 600;
            color: #333333 !important;
            margin-bottom: 0.3rem;
        }

        .method-desc {
            font-size: 0.9rem;
            color: #666666 !important;
            opacity: 1 !important;
        }

        /* 門市選擇區域 */
        #store-selection {
            margin-top: 1.5rem;
        }

        /* 修改選擇門市按鈕樣式 */
        .select-store-btn {
            width: 100% !important; /* 確保按鈕寬度為100% */
            background: linear-gradient(to bottom, #4c4d52, #222222) !important;
            color: #fce1bd !important;
            border: none !important;
            border-radius: 5px !important;
            cursor: pointer !important;
            font-weight: bold !important;
            font-size: 16px !important;
            padding: 0.8rem 1.5rem !important;
            transition: all 0.3s ease;
            display: flex !important; /* 確保內容居中 */
            align-items: center !important;
            justify-content: center !important;
            gap: 0.5rem !important;
        }

        .select-store-btn:hover {
            background: linear-gradient(to bottom, #3a3b40, #1a1a1a) !important; /* 稍微暗一點的漸層 */
            transform: translateY(-2px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.2) !important;
        }

        .select-store-btn i {
            color: #fce1bd !important; /* 圖標也改為金色 */
            font-size: 1.2rem;
        }

        /* 門市信息顯示 */
        .store-info {
            margin-top: 1.5rem;
            background: #FFFFFF !important;
            border-radius: 12px;
            overflow: hidden;
            border: 1px solid #E8E8E8 !important;
        }

        .store-info-header {
            background: #4A6741 !important;
            color: #FFFFFF !important;
            padding: 1rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            border-bottom: 1px solid #E8E8E8 !important;
            padding-bottom: 10px !important;
            margin-bottom: 1rem !important;
        }

        .store-info-content {
            padding: 1.5rem;
            background: #FFFFFF !important;
            border: 1px solid #E8E8E8 !important;
            border-radius: 12px;
            margin: 1rem 0;
        }

        .store-info-item {
            display: flex;
            padding: 0.8rem 0;
            border-bottom: 1px dashed #E8E8E8 !important;
        }

        .store-info-item:last-child {
            border-bottom: none;
        }

        .store-info-label {
            width: 100px;
            color: #666666 !important;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            opacity: 0.8 !important;
        }

        .store-info-value {
            flex: 1;
            color: #333333 !important;
            font-weight: bold !important;
        }

        .change-store-btn {
            width: 100%;
            padding: 0.8rem;
            background: #4A6741 !important;
            color: #FFFFFF !important;
            border: none !important;
            border-radius: 5px !important;
            cursor: pointer !important;
            font-size: 16px !important;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            transition: all 0.3s ease;
            margin-top: 1rem;
        }

        .change-store-btn:hover {
            background: var(--secondary-color);
            transform: translateY(-2px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

/* 懸浮按鈕容器 */
.floating-buttons {
    position: fixed;
    right: 5px; /* 減少右側間距，使按鈕更靠右 */
    top: calc(50% + 200px);
    transform: translateY(-50%);
    display: flex;
    flex-direction: column;
    gap: 10px;
    z-index: 99;
}

/* 懸浮按鈕基本樣式 */
.floating-button {
    width: 70px;
    height: 70px;
    border-radius: 50%;
    background-color: transparent; /* 移除底色 */
    display: flex;
    justify-content: center;
    align-items: center;
    box-shadow: none; /* 移除陰影 */
    cursor: pointer;
    transition: all 0.3s ease;
    position: relative;
}

/* 懸浮按鈕懸停效果 */
.floating-button:hover {
    transform: translateY(-3px);
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
}

/* 按鈕內的圖片樣式 */
.floating-button img {
    width: 70px;
    height: 70px;
    object-fit: contain;
}

/* LINE 按鈕特殊樣式 */
.line-button {
    background-color: #06C755; /* LINE 的綠色背景 */
    border-radius: 50%; /* 圓形 */
    width: 60px;
    height: 60px;
    display: flex;
    justify-content: center;
    align-items: center;
    box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    overflow: hidden; /* 確保內容不超出圓形範圍 */
    margin-left: auto; /* 使按鈕靠右 */
    margin-right: 0; /* 確保右側無邊距 */
    right: 5px; /* 額外向右偏移 */
    position: relative; /* 確保right屬性生效 */
}

.line-button img {
    width: 50px; /* 圖標稍小一些，讓背景顯示出來 */
    height: 50px;
    object-fit: contain;
}

/* 手機端適配 */
@media (max-width: 768px) {
    .line-button {
        width: 60px;
        height: 60px;
		right: -10px; /* 額外向右偏移 */
    }
    
    .line-button img {
        width: 35px;
        height: 35px;
    }
}

/* 購物車按鈕特殊樣式 */
.cart-button {
    background-color: transparent; /* 移除底色 */
}

/* 首頁按鈕特殊樣式 - 僅在手機端添加純白背景 */
.home-button {
    background-color: transparent; /* 默認為透明背景 */
    box-shadow: none; /* 默認無陰影 */
}

/* 購物車數量標記 */
.cart-count {
    position: absolute;
    top: -8px;
    right: -8px;
    background-color: #E9967A;
    color: white;
    border-radius: 50%;
    width: 24px;
    height: 24px;
    font-size: 12px;
    display: flex;
    justify-content: center;
    align-items: center;
    font-weight: bold;
    transition: transform 0.3s ease;
    box-shadow: 0 2px 5px rgba(0,0,0,0.2);
}

/* 購物車數量增加動畫 */
@keyframes cartBump {
    0% { transform: scale(1); }
    50% { transform: scale(1.4); }
    100% { transform: scale(1); }
}

.cart-count.bump {
    animation: cartBump 0.3s ease;
}

/* 手機端適配 */
@media (max-width: 768px) {
    .floating-buttons {
        right: 10px;
    }
    
    .floating-button {
        width: 60px;
        height: 60px;
		right: -8px; /* 額外向右偏移 */
    }
    
    .floating-button img {
        width: 75px;
        height: 75px;
    }
    
    /* LINE 按鈕圖片特殊尺寸 */
    .line-button img {
        width: 60px;
        height: 60px;
    }
    
    /* 手機端首頁按鈕添加背景 */
    .home-button {
        background-color: white;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    }
    
    .cart-count {
        width: 24px;
        height: 24px;
        font-size: 12px;
        top: -8px;
        right: -2px;
    }
}
		
		
.cart-back-btn {
    position: absolute;
    top: 15px;
    right: 15px;
    background-color: var(--primary-color);
    color: white;
    padding: 8px 16px;
    border-radius: 20px;
    font-size: 1rem;
    font-weight: 500;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 6px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    transition: all 0.2s ease;
    z-index: 10;
}

.cart-back-btn:hover {
    background-color: var(--secondary-color);
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.25);
}

.cart-back-btn i {
    font-size: 0.9rem;
}

/* 手機版樣式調整 */
@media (max-width: 768px) {
    .cart-back-btn {
        top: 10px;
        right: 10px;
        padding: 7px 14px;
        font-size: 0.9rem;
    }
}
.item-subtotal {
    margin-top: 1rem;
    text-align: right;
    font-weight: 600;
    color: var(--primary-color);
    border-top: 1px solid var(--border-color);
    padding-top: 0.5rem;
}

.item-price {
    font-size: 1.1rem;
}

    </style>
    <!-- 立即執行的腳本，在頁面加載前恢復購物車數據 -->
    <script>
        // 簡化的購物車檢查腳本
        (function() {
            try {
                const cartItems = JSON.parse(localStorage.getItem('cartItems') || '[]');
                if (cartItems.length === 0) {
                    console.log("警告：購物車為空");
                }
            } catch (e) {
                console.error("檢查購物車數據時發生錯誤:", e);
            }
        })();
    </script>

    <!-- 在 </head> 標籤前添加以下腳本 -->
    <script>
    // 頁面加載完成時立即檢查購物車
    document.addEventListener('DOMContentLoaded', function() {
        console.log('檢查購物車狀態...');
        checkCartStatus();
    });

    // 立即執行檢查（不等待 DOMContentLoaded）
    (function() {
        console.log('立即檢查購物車狀態...');
        checkCartStatus();
    })();

    function checkCartStatus() {
        try {
            const cartData = localStorage.getItem('cartItems');
            console.log('購物車數據:', cartData);
            
            // 檢查購物車是否為空
            if (!cartData || cartData === '[]' || cartData === 'null') {
                console.log('購物車為空，顯示錯誤提示');
                showEmptyCartError();
                return;
            }

            // 嘗試解析購物車數據
            const cartItems = JSON.parse(cartData);
            if (!Array.isArray(cartItems) || cartItems.length === 0) {
                console.log('購物車數據無效，顯示錯誤提示');
                showEmptyCartError();
                return;
            }

            console.log('購物車檢查通過，商品數量:', cartItems.length);
        } catch (error) {
            console.error('檢查購物車時發生錯誤:', error);
            showEmptyCartError();
        }
    }
    </script>
<script type="text/javascript" async="" src="./Mist _ 結帳頁面_files/f.txt"></script><script type="text/javascript" async="" src="./Mist _ 結帳頁面_files/f(1).txt"></script><script type="text/javascript" async="" src="./Mist _ 結帳頁面_files/f(2).txt"></script><script type="text/javascript" async="" src="./Mist _ 結帳頁面_files/f(3).txt"></script><script type="text/javascript" async="" src="./Mist _ 結帳頁面_files/f(4).txt"></script><script type="text/javascript" async="" src="./Mist _ 結帳頁面_files/f(5).txt"></script><script type="text/javascript" async="" src="./Mist _ 結帳頁面_files/f(6).txt"></script><script type="text/javascript" async="" src="./Mist _ 結帳頁面_files/f(7).txt"></script><script type="text/javascript" async="" src="./Mist _ 結帳頁面_files/f(8).txt"></script><script type="text/javascript" async="" src="./Mist _ 結帳頁面_files/f(9).txt"></script><script type="text/javascript" async="" src="./Mist _ 結帳頁面_files/f(10).txt"></script><script type="text/javascript" async="" src="./Mist _ 結帳頁面_files/f(11).txt"></script><script type="text/javascript" async="" src="./Mist _ 結帳頁面_files/f(12).txt"></script><script type="text/javascript" async="" src="./Mist _ 結帳頁面_files/f(13).txt"></script></head>
<body>
    <!-- 添加隱藏字段用於從 PHP session 恢復購物車數據 -->
        
    <!-- 頂部導航 -->
    <header class="header">
        <div class="nav-container">
            <img src="./Mist _ 結帳頁面_files/logo.png" alt="Logo" class="logo">
        </div>
    </header>

    <div class="checkout-container">
        <!-- 結帳步驟 -->
        <div class="checkout-steps">
            <div class="step active">
                <i class="fas fa-shopping-cart"></i>
                <span>確認訂單</span>
            </div>
            <div class="step">
                <i class="fas fa-user"></i>
                <span>填寫資料</span>
            </div>
            <div class="step">
                <i class="fas fa-check-circle"></i>
                <span>完成訂購</span>
            </div>
        </div>

        <!-- 訂單摘要 -->
        <div class="order-summary">
            <h2 class="summary-title">訂單摘要</h2>
            <div class="cart-items" id="cartItemsList">
                <div class="cart-item">
                    <img src="./Mist _ 結帳頁面_files/68872403adc9b.jpg" alt="RELX 悅刻 拋棄式" class="item-image">
                    <div class="item-details">
                        <div class="item-name">RELX 悅刻 拋棄式</div>
                        <div class="cart-discount-title">買十送一<br>購物車請加入11隻唷</div>
                        
                            <div class="item-option">
                                <span class="item-option-name">綠豆冰</span>
                                <span class="item-option-quantity">1</span>
                                <span class="item-option-price">$390</span>
                            </div>
                        
                        <div class="item-subtotal">
                            <span>小計：</span>
                            <span class="item-price">$390</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="total-amount">
            <div class="total-summary">
                <div class="total-row">
                    <span>運費：</span>
                    <span>$60</span>
                </div>
                <div class="total-row total-final">
                    <span>總計：</span>
                    <span id="totalAmount">$450</span>
                </div>
            </div>
        </div>
        </div>

        <!-- 配送方式 -->
        <div class="checkout-section">
            <h2 class="section-title"><i class="fas fa-store"></i> 配送方式</h2>
            
            <div class="shipping-method active" data-type="cvs">
                <div class="method-icon">
                    <i class="fas fa-store-alt"></i>
                </div>
                <div class="method-info">
                    <div class="method-name">7-11 超商取貨付款</div>
                    <div class="method-desc">預計 2-3 個工作日送達<br>消費滿 NT$ 1,500 免運費</div>
                </div>
            </div>
            
            <!-- 超商門市選擇區域 -->
            <div id="store-selection">
                <button type="button" class="select-store-btn" onclick="openGreenMap()">
                    <i class="fas fa-map-marker-alt"></i> 選擇 7-11 門市
                </button>
                
                <div id="store-info" style="display: none;">
                    <div class="store-info-header">
                        <i class="fas fa-store"></i> 已選擇門市
                    </div>
                    <div class="store-info-content">
                        <div class="store-info-item">
                            <span class="store-info-label">門市名稱：</span>
                            <span id="store-name" class="store-info-value"></span>
                        </div>
                        <div class="store-info-item">
                            <span class="store-info-label">門市地址：</span>
                            <span id="store-address" class="store-info-value"></span>
                        </div>
                        <div class="store-info-item">
                            <span class="store-info-label">門市代號：</span>
                            <span id="store-code" class="store-info-value"></span>
                        </div>
                    </div>
                    <button type="button" class="change-store-btn" onclick="openGreenMap()">
                        <i class="fas fa-exchange-alt"></i> 重新選擇門市
                    </button>
                </div>
            </div>
            
            <input type="hidden" id="shipping_method" name="shipping_method" value="cvs">
            <input type="hidden" id="store_id" name="store_id" value="">
            <input type="hidden" id="store_name" name="store_name" value="">
            <input type="hidden" id="store_address" name="store_address" value="">
        </div>

        <!-- 訂購資料表單 -->
        <form class="form-section" id="checkoutForm" name="recipient-form">
            <h2 class="section-title"><i class="fas fa-store"></i> 收件資料</h2>		
            <div class="form-group">
                <label class="form-label">姓名</label>
                <input type="text" class="form-input" name="name" required="">
            </div>
            <div class="form-group">
                <label class="form-label">電話</label>
                <input type="tel" class="form-input" name="phone" required="">
            </div>
            <div class="form-group">
                <label class="form-label">備註</label>
                <textarea class="form-input" name="notes" rows="3"></textarea>
            </div>
            <button type="submit" class="submit-button">確認送出</button>
        </form>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            console.log("Checkout.php 頁面加載完成");
            
            // 檢查是否為安卓設備
            const isAndroid = /Android/i.test(navigator.userAgent);
            const isChrome = /Chrome/i.test(navigator.userAgent) && !/Edge|Edg/i.test(navigator.userAgent);
            
            // 檢查是否為 LINE 登入用戶
                        console.log("遊客模式");
                        
            // 簡化的購物車檢查
            console.log("檢查購物車數據");
            
            // 檢查購物車是否為空，如果為空則顯示警告
            const cartItems = JSON.parse(localStorage.getItem('cartItems') || '[]');
            if (cartItems.length === 0) {
                console.warn('警告：購物車為空！嘗試從所有可能的來源恢復數據後仍然為空。');
                
                // 如果是從地圖回來，顯示錯誤提示
                const fromMap = new URLSearchParams(window.location.search).get('from_map');
                if (fromMap === '1') {
                    Swal.fire({
                        icon: 'warning',
                        title: '購物車數據丟失',
                        text: '系統無法恢復您的購物車數據，請返回首頁重新選購商品。',
                        confirmButtonText: '返回首頁',
                        allowOutsideClick: false
                    }).then((result) => {
                        if (result.isConfirmed) {
                            window.location.href = 'index.php';
                        }
                    });
                }
            } else {
                // 購物車有數據，加載商品
                loadCartItems();
                
                // 檢查是否有錯誤訊息
                const urlParams = new URLSearchParams(window.location.search);
                const error = urlParams.get('error');
                const errorMessage = urlParams.get('message');
                
                if (error === 'no_store_selected') {
                    // 顯示錯誤訊息
                    Swal.fire({
                        icon: 'warning',
                        title: '未選擇門市',
                        text: errorMessage || '請選擇一個取貨門市',
                        confirmButtonText: '確定'
                    });
                }
                
                // 檢查 URL 參數中是否有門市信息
                const storeId = urlParams.get('CVSStoreID');
                const storeName = urlParams.get('CVSStoreName');
                const storeAddress = urlParams.get('CVSAddress');
                const storeTel = urlParams.get('CVSTelephone');
                
                console.log('URL Parameters:', {
                    storeId,
                    storeName,
                    storeAddress,
                    storeTel
                });
                
                if (storeId && storeName && storeAddress) {
                    try {
                        // 顯示門市信息區域
                        const storeInfoDiv = document.getElementById('store-info');
                        if (storeInfoDiv) {
                            storeInfoDiv.style.display = 'block';
                            
                            // 更新門市信息顯示
                            document.getElementById('store-name').textContent = decodeURIComponent(storeName);
                            document.getElementById('store-address').textContent = decodeURIComponent(storeAddress);
                            document.getElementById('store-code').textContent = storeId;
                            
                            // 隱藏選擇門市按鈕
                            const selectStoreBtn = document.querySelector('.select-store-btn');
                            if (selectStoreBtn) {
                                selectStoreBtn.style.display = 'none';
                            }
                            
                            // 更新隱藏的表單欄位
                            document.getElementById('store_id').value = storeId;
                            document.getElementById('store_name').value = decodeURIComponent(storeName);
                            document.getElementById('store_address').value = decodeURIComponent(storeAddress);
                            
                            // 平滑滾動到收件資料區塊
                            setTimeout(() => {
                                document.querySelector('[name="recipient-form"]').scrollIntoView({ 
                                    behavior: 'smooth',
                                    block: 'start'
                                });
                            }, 500);
                        }
                    } catch (error) {
                        console.error('Error processing store info:', error);
                        // 顯示錯誤訊息給用戶
                        Swal.fire({
                            icon: 'error',
                            title: '處理門市資料時發生錯誤',
                            text: '請重新選擇門市',
                            confirmButtonText: '確定'
                        });
                    }
                }
            }
            
            // 簡化的購物車日誌
            const currentCart = localStorage.getItem('cartItems');
            if (currentCart) {
                console.log('購物車數據已載入');
            }
        });

        /**
         * 簡化的購物車檢查函數
         */
        function restoreCartFromSession() {
            try {
                const currentCart = localStorage.getItem('cartItems');
                if (!currentCart || JSON.parse(currentCart).length === 0) {
                    console.log('購物車為空');
                    return false;
                }
                console.log('購物車數據正常');
                return true;
            } catch (error) {
                console.error('檢查購物車數據時發生錯誤:', error);
                return false;
            }
        }

        function loadCartItems() {
            try {
                const cartItemsStr = localStorage.getItem('cartItems');
                console.log('原始購物車數據:', cartItemsStr);
                
                if (!cartItemsStr) {
                    console.error('購物車數據為空');
                    showEmptyCartError();
                    return;
                }
                
                const cartItems = JSON.parse(cartItemsStr);
                console.log('解析後的購物車數據:', cartItems);
                
                if (!Array.isArray(cartItems) || cartItems.length === 0) {
                    console.error('購物車數據不是數組或為空數組');
                    showEmptyCartError();
                    return;
                }
                
                const cartItemsList = document.getElementById('cartItemsList');
                let subtotal = 0;  // 小計
                
                // 按商品ID分組
                const groupedItems = {};
                
                // 第一次遍歷 - 分組商品
                cartItems.forEach(item => {
                    if (!item) return;
                    
                    const productId = item.productId || '';
                    if (!groupedItems[productId]) {
                        groupedItems[productId] = {
                            productId: productId,
                            productName: item.productName || '',
                            image: item.image || '',
                            discount_title: item.discount_title || '',
                            options: [],
                            totalQuantity: 0,
                            promotions: item.promotions || []
                        };
                    }
                    
                    // 添加選項
                    groupedItems[productId].options.push({
                        optionId: item.optionId || '',
                        optionName: item.optionName || '',
                        quantity: parseInt(item.quantity) || 0,
                        price: parseFloat(item.price) || 0
                    });
                    
                    // 累加總數量
                    groupedItems[productId].totalQuantity += parseInt(item.quantity) || 0;
                });
                
                // 轉換為數組
                const mergedItems = Object.values(groupedItems);
                console.log('合併後的商品:', mergedItems);
                
                // 生成 HTML
                let html = '';
                
                mergedItems.forEach(item => {
                    // 處理圖片路徑
                    let imagePath = '';
                    if (item.image) {
                        if (item.image.startsWith('admin/')) {
                            imagePath = item.image;
                        } else if (item.image.includes('/')) {
                            imagePath = `admin/uploads/${item.image.split('/').pop()}`;
                        } else {
                            imagePath = `admin/uploads/${item.image}`;
                        }
                    } else {
                        imagePath = 'admin/uploads/default.webp';
                    }
                    
                    // 計算商品總價
                    let itemTotalPrice = 0;
                    
                    // 生成選項 HTML
                    const optionsHtml = item.options.map(option => {
                        const optionTotal = option.price * option.quantity;
                        itemTotalPrice += optionTotal;
                        
                        return `
                            <div class="item-option">
                                <span class="item-option-name">${option.optionName}</span>
                                <span class="item-option-quantity">${option.quantity}</span>
                                <span class="item-option-price">$${Math.round(option.price).toLocaleString()}</span>
                            </div>
                        `;
                    }).join('');
                    
                    // 應用促銷折扣
                    if (item.promotions && item.promotions.length > 0) {
                        try {
                            const promoRules = typeof item.promotions === 'string' ? 
                                JSON.parse(item.promotions) : item.promotions;
                            
                            // 按數量從大到小排序折扣規則
                            const sortedPromotions = promoRules.sort((a, b) => b.quantity - a.quantity);
                            
                            // 找到第一個適用的折扣規則
                            const applicablePromotion = sortedPromotions.find(p => 
                                item.totalQuantity >= (parseInt(p.quantity) + parseInt(p.discount_price)));
                            
                            if (applicablePromotion) {
                                // 滿X送Y的邏輯
                                const buyQuantity = parseInt(applicablePromotion.quantity); // 滿X
                                const freeQuantity = parseInt(applicablePromotion.discount_price); // 送Y
                                const groupSize = buyQuantity + freeQuantity; // 一組共X+Y個
                                
                                // 計算完整組數
                                const groups = Math.floor(item.totalQuantity / groupSize);
                                
                                // 計算剩餘不足一組的商品數量
                                const remainder = item.totalQuantity % groupSize;
                                
                                // 計算實際付費數量
                                const paidQuantity = (groups * buyQuantity) + Math.min(remainder, buyQuantity);
                                
                                // 計算平均單價
                                const avgPrice = itemTotalPrice / item.totalQuantity;
                                
                                // 總價 = 實際付費數量 * 平均單價
                                itemTotalPrice = paidQuantity * avgPrice;
                                
                                console.log(`商品: ${item.productName}, 總數量: ${item.totalQuantity}, 促銷規則: 滿${buyQuantity}送${freeQuantity}, 折扣數量: ${paidQuantity}, 原價: ${itemTotalPrice}, 折後價: ${itemTotalPrice}`);
                            }
                        } catch (e) {
                            console.error('計算促銷折扣時發生錯誤:', e);
                        }
                    }
                    
            // 累加總計
            subtotal += itemTotalPrice;
            
            // 生成商品 HTML
            html += `
                <div class="cart-item">
                    <img src="${imagePath}" alt="${item.productName}" class="item-image">
                    <div class="item-details">
                        <div class="item-name">${item.productName}</div>
                        ${item.discount_title ? `<div class="cart-discount-title">${item.discount_title}</div>` : ''}
                        ${optionsHtml}
                        <div class="item-subtotal">
                            <span>小計：</span>
                            <span class="item-price">$${Math.round(itemTotalPrice).toLocaleString()}</span>
                        </div>
                    </div>
                </div>
            `;
        });
        
        cartItemsList.innerHTML = html;
        
        // 計算運費和總計
        const shipping = subtotal >= 1500 ? 0 : 60;
        const total = subtotal + shipping;
        
        // 更新顯示
        document.querySelector('.total-amount').innerHTML = `
            <div class="total-summary">
                <div class="total-row">
                    <span>運費：</span>
                    <span>${shipping === 0 ? '免運費' : '$' + shipping}</span>
                </div>
                <div class="total-row total-final">
                    <span>總計：</span>
                    <span id="totalAmount">$${Math.round(total).toLocaleString()}</span>
                </div>
            </div>
        `;
        
        // Meta Pixel 追蹤 - 開始結帳事件
        if (typeof fbq !== 'undefined') {
            const trackingData = {
                value: total,
                currency: 'TWD',
                num_items: mergedItems.reduce((sum, item) => sum + item.totalQuantity, 0)
            };
            // 發送到兩個 Pixel ID
            fbq('trackSingle', '2163547264137225', 'InitiateCheckout', trackingData);
            fbq('trackSingle', '3898281196984160', 'InitiateCheckout', trackingData);
        }
        
    } catch (error) {
        console.error('加載購物車數據時出錯:', error);
        showEmptyCartError();
    }
}

// 修改錯誤提示函數
function showEmptyCartError() {
    console.log('執行錯誤提示函數');
    let timerInterval;
    
    const style = document.createElement('style');
    style.textContent = `
        .custom-popup-class {
            background-color: #fff !important;
            border-radius: 12px !important;
            padding: 1.5rem !important;
            max-width: 320px !important;
        }
        
        .custom-title-class {
            color: #333 !important;
            font-size: 1.1rem !important;
            font-weight: 600 !important;
            margin-bottom: 0.8rem !important;
            font-family: monospace !important;
            text-align: center !important;
        }
        
        .custom-content-class {
            color: #666 !important;
            font-size: 0.9rem !important;
            padding-left: 10px !important;
            text-align: left !important;
        }
        
        .timer-text {
            color: #999 !important;
            font-size: 0.75rem !important;
            text-align: center !important;
            margin-top: 1rem !important;
        }
    `;
    document.head.appendChild(style);

    Swal.fire({
        icon: 'error',
        title: 'Error : 5003 網路異常',
        html: `
            <div class="custom-content-class">目前來客數較多，請稍後再試！</div>
            <div class="timer-text"><b>3</b> 秒後自動返回首頁</div>
        `,
        showConfirmButton: true,
        confirmButtonText: '返回首頁',
        confirmButtonColor: '#4A6741',
        allowOutsideClick: false,
        timer: 3000,
        timerProgressBar: true,
        customClass: {
            popup: 'custom-popup-class',
            title: 'custom-title-class',
            confirmButton: 'custom-confirm-button-class'
        },
        didOpen: (popup) => {
            const timer = popup.querySelector('b');
            timerInterval = setInterval(() => {
                if (timer) {
                    const timeLeft = Math.ceil(Swal.getTimerLeft() / 1000);
                    timer.textContent = timeLeft;
                }
            }, 100);
        },
        willClose: () => {
            clearInterval(timerInterval);
        }
    }).then((result) => {
        window.location.href = 'index.php';
    });

    setTimeout(() => {
        window.location.href = 'index.php';
    }, 3000);
}

/**
 * 計算折扣後的價格 - 處理滿X送Y的促銷
 * @param {number} price - 原始價格
 * @param {number} quantity - 數量
 * @param {string} discountTitle - 折扣標題
 * @param {Array} promotions - 促銷信息，格式如 [{"quantity":10,"discount_price":1}] 表示滿10送1
 * @return {number} - 折扣後的總價
 */
function calculateDiscountedPrice(price, quantity, discountTitle, promotions) {
    try {
        console.log("計算折扣:", price, quantity, discountTitle, "原價:", price * quantity, "促銷:", promotions);
        
        // 原始總價
        const originalPrice = price * quantity;
        
        // 如果有促銷信息，優先使用促銷信息計算折扣
        if (promotions && Array.isArray(promotions) && promotions.length > 0) {
            console.log("使用促銷信息計算折扣 - 滿X送Y");
            
            try {
                const promoRules = typeof promotions === 'string' ? 
                    JSON.parse(promotions) : promotions;
                
                // 按數量從大到小排序折扣規則
                const sortedPromotions = promoRules.sort((a, b) => b.quantity - a.quantity);
                
                // 找到第一個適用的折扣規則
                const applicablePromotion = sortedPromotions.find(p => 
                    quantity >= (parseInt(p.quantity) + parseInt(p.discount_price)));
                
                if (applicablePromotion) {
                    console.log('找到適用的促銷規則:', applicablePromotion);
                    
                    // 滿X送Y的邏輯
                    const buyQuantity = parseInt(applicablePromotion.quantity); // 滿X
                    const freeQuantity = parseInt(applicablePromotion.discount_price); // 送Y
                    const groupSize = buyQuantity + freeQuantity; // 一組共X+Y個
                    
                    // 計算完整組數
                    const groups = Math.floor(quantity / groupSize);
                    
                    // 計算剩餘不足一組的商品數量
                    const remainder = quantity % groupSize;
                    
                    // 計算實際付費數量：完整組數*滿X + 剩餘數量(但不超過滿X)
                    const paidQuantity = (groups * buyQuantity) + Math.min(remainder, buyQuantity);
                    
                    // 總價 = 實際付費數量 * 單價
                    const discountedPrice = paidQuantity * price;
                    
                    console.log(`滿${buyQuantity}送${freeQuantity}: 商品數量: ${quantity}, 分組: ${groups}, 餘數: ${remainder}, 實付數量: ${paidQuantity}, 原價: ${originalPrice}, 折後價: ${discountedPrice}`);
                    
                    return discountedPrice;
                }
            } catch (e) {
                console.error('解析促銷規則時發生錯誤:', e);
            }
        }
        
        // 如果沒有任何折扣，返回原價
        return originalPrice;
    } catch (e) {
        console.error('計算折扣價格時發生錯誤:', e, '參數:', {price, quantity, discountTitle, promotions});
        return price * quantity;
    }
}

// 表單提交處理
document.getElementById('checkoutForm').addEventListener('submit', function(e) {
    e.preventDefault();
    
    // 檢查電話號碼格式
    const phoneNumber = this.querySelector('input[name="phone"]').value;
    const phoneRegex = /^09\d{8}$/;
    
    if (!phoneRegex.test(phoneNumber)) {
        Swal.fire({
            icon: 'warning',
            title: '電話號碼格式錯誤',
            text: '請輸入正確的台灣手機號碼（09開頭的10位數字）',
            confirmButtonText: '確定'
        });
        return;
    }
    
    // 顯示加載中提示
    Swal.fire({
        title: '處理中...',
        text: '正在提交您的訂單',
        allowOutsideClick: false,
        didOpen: () => {
            Swal.showLoading();
        }
    });
    
    // 獲取當前模式
    const currentMode = new URLSearchParams(window.location.search).get('mode') || 'guest';
    console.log('Current mode:', currentMode);
    
    // 檢查購物車是否為空
    const cartItems = JSON.parse(localStorage.getItem('cartItems')) || [];
    if (cartItems.length === 0) {
        Swal.fire({
            icon: 'warning',
            title: '購物車是空的',
            text: '請先添加商品到購物車',
            confirmButtonText: '確定'
        });
        return;
    }

    // 檢查是否已選擇門市
    const storeId = document.getElementById('store_id').value;
    const storeName = document.getElementById('store_name').value;
    const storeAddress = document.getElementById('store_address').value;

    if (!storeId || !storeName || !storeAddress) {
        Swal.fire({
            icon: 'warning',
            title: '請選擇取貨門市',
            text: '請點擊「選擇 7-11 門市」按鈕選擇取貨門市',
            confirmButtonText: '確定'
        });
        return;
    }

    // 獲取表單數據
    const formData = new FormData(this);
    const totalAmount = document.getElementById('totalAmount').textContent.replace('$', '').replace(',', '');

    // 準備要發送的數據
    const submitData = new FormData();
    submitData.append('name', formData.get('name'));
    submitData.append('phone', formData.get('phone'));
    submitData.append('email', ''); // 如果需要可以添加 email 欄位
    submitData.append('total_price', totalAmount);
    submitData.append('store_name', storeName);
    submitData.append('store_address', storeAddress);
    submitData.append('store_id', storeId);
    submitData.append('remark', formData.get('notes'));
    submitData.append('recipient_name', formData.get('name')); // 收件人姓名
    
    // 添加 LINE 用戶 ID (如果有)
        submitData.append('user_id', 'guest_' + Date.now());
    console.log('添加臨時遊客 ID 到訂單');
        
    // 修改提交的購物車數據，包含折扣後的價格
    const cartJSON = JSON.stringify(cartItems.map(item => {
        // 計算折扣後的總價
        const discountedTotal = calculateDiscountedPrice(parseFloat(item.price), parseInt(item.quantity), item.discount_title, item.promotions);
        
        return {
            productId: item.productId,
            productName: item.productName,
            optionId: parseInt(item.optionId),
            optionName: item.optionName,
            quantity: parseInt(item.quantity),
            price: parseFloat(item.price),
            discountedPrice: discountedTotal / parseInt(item.quantity), // 折扣後的單價
            discountedTotal: discountedTotal, // 折扣後的總價
            discount_title: item.discount_title || ''
        };
    }));
    
    submitData.append('cart', cartJSON);

    // 在發送前打印數據
    console.log('Cart Data:', cartItems);
    console.log('Submit Data:', Object.fromEntries(submitData.entries()));
    console.log('Submitting to URL:', `submit_order.php?mode=${currentMode}`);

    // 發送訂單到後端，包含當前模式參數
    fetch(`submit_order.php?mode=${currentMode}`, {
        method: 'POST',
        body: submitData
    })
    .then(response => {
        console.log('Response status:', response.status);
        console.log('Response headers:', response.headers);
        
        if (!response.ok) {
            throw new Error(`HTTP error! Status: ${response.status}`);
        }
        
        return response.text().then(text => {
            console.log('Raw response:', text);
            
            try {
                // 嘗試解析 JSON
                return JSON.parse(text);
            } catch (e) {
                // 如果解析失敗，記錄原始響應並拋出錯誤
                console.error('Failed to parse JSON response:', text);
                throw new Error('伺服器返回無效的 JSON 數據');
            }
        });
    })
    .then(data => {
        console.log('Server response:', data);
        
        if (data.success) {
            // Meta Pixel 追蹤 - 購買完成事件
            if (typeof fbq !== 'undefined') {
                const cartItems = JSON.parse(localStorage.getItem('cartItems')) || [];
                const totalAmount = parseFloat(document.querySelector('#totalAmount').textContent.replace(/[^0-9.]/g, ''));
                
                const purchaseData = {
                    value: totalAmount,
                    currency: 'TWD'
                };
                // 發送到兩個 Pixel ID
                fbq('trackSingle', '2163547264137225', 'Purchase', purchaseData);
                fbq('trackSingle', '3898281196984160', 'Purchase', purchaseData);
            }
            
            // 清空購物車
            localStorage.removeItem('cartItems');
            
            // 創建計時器變量
            let timerInterval;
            let secondsLeft = 30;
            
            // 格式化訂單編號 (添加R前綴)
            const orderNumber = data.orderNumber;
            
            // 顯示成功訊息 - 美化版本
            Swal.fire({
                icon: 'success',
                title: '訂購成功！',
                html: `
                    <div style="text-align: center; padding: 10px; background-color: #4c4d52; border-radius: 12px; margin-bottom: 15px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                        <div style="margin: 10px 0; font-size: 18px;">
                            <span style="font-weight: bold; color: #fce1bd; font-size: 22px;">訂單編號：${orderNumber}</span>
                        </div>
                        <div style="margin: 15px 0; padding: 10px; border-top: 1px dashed #ddd; border-bottom: 1px dashed #ddd;">
                            <p style="color: #fce1bd; font-size: 16px; margin: 5px 0;">可透過官方LINE查詢訂單 !</p>
                        </div>
                        <div style="margin-top: 12px; font-size: 14px; color: #fce1bd;">
                            <i class="fas fa-clock" style="margin-right: 5px;"></i>
                            <b>${secondsLeft}</b> 秒後自動返回首頁
                        </div>
                    </div>
                `,
                showConfirmButton: true,
                confirmButtonText: '返回首頁',
                confirmButtonColor: '#4c4d52',
                showCancelButton: true,
                cancelButtonText: '<i class="fab fa-line"></i> 加入LINE官方帳號',
                cancelButtonColor: '#4c4d52',
                allowOutsideClick: false,
                timer: 30000,
                timerProgressBar: true,
                customClass: {
                    popup: 'order-success-popup',
                    title: 'order-success-title',
                    htmlContainer: 'order-success-content',
                    confirmButton: 'order-success-confirm',
                    cancelButton: 'order-success-cancel'
                },
                didOpen: () => {
                    // 添加自定義樣式
                    const style = document.createElement('style');
                    style.textContent = `
                        .order-success-popup {
                            padding: 1.5em;
                            border-radius: 15px;
                            background-color: #fff;
                        }
                        .order-success-title {
                            color: #4c4d52;
                            font-size: 1.8em;
                            font-weight: 600;
                            margin-bottom: 15px;
                        }
                        .order-success-content {
                            font-size: 1.1em;
                        }
                        .order-success-confirm {
                            border-radius: 8px !important;
                            font-weight: 600 !important;
                        }
                        .order-success-cancel {
                            border-radius: 8px !important;
                            font-weight: 600 !important;
                        }
                    `;
                    document.head.appendChild(style);
                    
                    // 更新計時器
                    timerInterval = setInterval(() => {
                        secondsLeft -= 1;
                        const timerElement = Swal.getHtmlContainer().querySelector('b');
                        if (timerElement) {
                            timerElement.textContent = secondsLeft;
                        }
                    }, 1000);
                },
                willClose: () => {
                    clearInterval(timerInterval);
                }
            }).then((result) => {
                if (result.dismiss === Swal.DismissReason.cancel) {
                    // 用戶點擊了加入LINE官方帳號按鈕
                    window.open('https://line.me/R/ti/p/@663aotvo', '_blank');
                    // 然後返回首頁
                    window.location.href = 'index.php';
                } else {
                    // 用戶點擊了返回首頁按鈕或計時器結束
                    window.location.href = 'index.php';
                }
            });
        } else {
            throw new Error(data.message || '訂單處理失敗');
        }
    })
    .catch(error => {
        console.error('Error:', error);
        Swal.fire({
            icon: 'error',
            title: '發生錯誤',
            text: error.message || '請稍後重試',
            confirmButtonText: '確定'
        });
    });
});

/**
 * 打開綠界地圖選擇門市
 */
function openGreenMap() {
    // 簡化版本 - 直接跳轉到綠界地圖
    const apiUrl = "https://logistics.ecpay.com.tw/Express/map";
    const merchantTradeNo = "Test" + Date.now();
    
    // 添加遊客模式到回調 URL
    let serverReplyURL = `https://mist16888.cc/callback.php?mode=guest&from_map=1`;
    
    const params = {
        MerchantID: "3382367",
        LogisticsType: "CVS",
        LogisticsSubType: "UNIMARTC2C",
        IsCollection: "N",
        ServerReplyURL: serverReplyURL,
        ExtraData: "",
        Device: 1,
        MerchantTradeNo: merchantTradeNo,
    };

    const queryString = Object.entries(params)
        .map(([key, value]) => `${key}=${value}`)
        .join('&');

    window.location.href = `${apiUrl}?${queryString}`;
}
    </script>

    <!-- 懸浮按鈕 -->
    <div class="floating-buttons">
        <a href="https://line.me/R/ti/p/@663aotvo" target="_blank" class="floating-button line-button" title="LINE 官方帳號">
            <img src="./Mist _ 結帳頁面_files/line-icon.png" alt="LINE" class="line-icon">
        </a>	
        <a href="https://mist16888.cc/index.php" class="floating-button home-button" title="回到首頁">
            <img src="./Mist _ 結帳頁面_files/home-icon.png" alt="首頁">
        </a>
    </div>

 <iframe allow="join-ad-interest-group" data-tagging-id="AW-17332384895" data-load-time="1754031008380" height="0" width="0" src="./Mist _ 結帳頁面_files/17332384895.html" style="display: none; visibility: hidden;"></iframe><iframe allow="join-ad-interest-group" data-tagging-id="AW-16772608886" data-load-time="1754031008411" height="0" width="0" src="./Mist _ 結帳頁面_files/16772608886.html" style="display: none; visibility: hidden;"></iframe><iframe allow="join-ad-interest-group" data-tagging-id="AW-16772608886/L0eHCPiV5usZEPbm5r0-" data-load-time="1754031008413" height="0" width="0" src="./Mist _ 結帳頁面_files/16772608886(1).html" style="display: none; visibility: hidden;"></iframe><iframe allow="join-ad-interest-group" data-tagging-id="AW-17332324191" data-load-time="1754031008438" height="0" width="0" src="./Mist _ 結帳頁面_files/17332324191.html" style="display: none; visibility: hidden;"></iframe><iframe allow="join-ad-interest-group" data-tagging-id="AW-17296918710" data-load-time="1754031008464" height="0" width="0" src="./Mist _ 結帳頁面_files/17296918710.html" style="display: none; visibility: hidden;"></iframe><iframe allow="join-ad-interest-group" data-tagging-id="AW-17379789012" data-load-time="1754031008489" height="0" width="0" src="./Mist _ 結帳頁面_files/17379789012.html" style="display: none; visibility: hidden;"></iframe><iframe allow="join-ad-interest-group" data-tagging-id="AW-17405252929" data-load-time="1754031008540" height="0" width="0" src="./Mist _ 結帳頁面_files/17405252929.html" style="display: none; visibility: hidden;"></iframe><iframe allow="join-ad-interest-group" data-tagging-id="AW-17372216978" data-load-time="1754031008565" height="0" width="0" src="./Mist _ 結帳頁面_files/17372216978.html" style="display: none; visibility: hidden;"></iframe><iframe allow="join-ad-interest-group" data-tagging-id="AW-17187571595" data-load-time="1754031008593" height="0" width="0" src="./Mist _ 結帳頁面_files/17187571595.html" style="display: none; visibility: hidden;"></iframe><iframe allow="join-ad-interest-group" data-tagging-id="AW-17261523412" data-load-time="1754031008595" height="0" width="0" src="./Mist _ 結帳頁面_files/17261523412.html" style="display: none; visibility: hidden;"></iframe><iframe allow="join-ad-interest-group" data-tagging-id="AW-17265651493" data-load-time="1754031008597" height="0" width="0" src="./Mist _ 結帳頁面_files/17265651493.html" style="display: none; visibility: hidden;"></iframe><iframe allow="join-ad-interest-group" data-tagging-id="AW-17296851483" data-load-time="1754031008600" height="0" width="0" src="./Mist _ 結帳頁面_files/17296851483.html" style="display: none; visibility: hidden;"></iframe><iframe allow="join-ad-interest-group" data-tagging-id="AW-17407247169" data-load-time="1754031008602" height="0" width="0" src="./Mist _ 結帳頁面_files/17407247169.html" style="display: none; visibility: hidden;"></iframe><iframe allow="join-ad-interest-group" data-tagging-id="AW-17407167683" data-load-time="1754031008632" height="0" width="0" src="./Mist _ 結帳頁面_files/17407167683.html" style="display: none; visibility: hidden;"></iframe><iframe height="0" width="0" style="display: none; visibility: hidden;" src="./Mist _ 結帳頁面_files/saved_resource.html"></iframe><script type="text/javascript" id="" charset="">(function(a,e,b,f,g,c,d){a[b]=a[b]||function(){(a[b].q=a[b].q||[]).push(arguments)};c=e.createElement(f);c.async=1;c.src="https://www.clarity.ms/tag/"+g+"?ref\x3dgtm2";d=e.getElementsByTagName(f)[0];d.parentNode.insertBefore(c,d)})(window,document,"clarity","script","oyaugvlpjg");</script></body></html>