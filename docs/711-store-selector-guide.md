# 7-11 門市選擇器使用指南

## 概述
本專案已完全參照 mist16888.cc 網站的做法，整合了綠界物流地圖 API 來實現 7-11 門市選擇功能。

## 功能特點

### 1. 使用綠界官方物流地圖
- 直接使用綠界提供的物流地圖服務
- 包含全台灣所有 7-11 門市（超過 6,000 間）
- 實時更新的門市資訊

### 2. 選擇流程
1. 用戶點擊「選擇 7-11 門市」按鈕
2. 跳轉到綠界物流地圖頁面
3. 在地圖上選擇門市
4. 系統自動返回並填入門市資訊

### 3. 門市資訊顯示
- 門市名稱
- 門市地址
- 門市代號
- 聯絡電話（如有提供）

## 技術實作

### 前端組件
- `StoreSelector.tsx`：門市選擇器組件
- 自動處理綠界回調參數
- 保存購物車狀態避免數據丟失

### 後端處理
- `/api/ecpay/callback`：處理綠界回調
- 自動重定向回前端結帳頁面

## 設定步驟

### 1. 申請綠界商店代號
```javascript
// 目前使用測試商店代號
MerchantID: "2000132"
```

### 2. 設定回調 URL
確保後端 API 的 URL 正確設定：
```javascript
const apiUrl = import.meta.env.VITE_API_URL || 'http://localhost:3001';
```

### 3. 部署時的注意事項
- 確保回調 URL 可以從外部訪問
- 設定正確的 CORS 政策
- 使用 HTTPS 以提高安全性

## 測試方法

1. 添加商品到購物車
2. 進入結帳頁面
3. 點擊「選擇 7-11 門市」按鈕
4. 在綠界地圖選擇門市
5. 確認門市資訊正確顯示

## 常見問題

### Q: 為什麼跳轉後購物車資料消失？
A: 系統已實作購物車備份機制，會在跳轉前保存資料。

### Q: 可以使用其他超商嗎？
A: 可以，只需修改 `LogisticsSubType` 參數：
- 7-11: `UNIMARTC2C`
- 全家: `FAMIC2C`
- 萊爾富: `HILIFEC2C`
- OK: `OKMARTC2C`

### Q: 如何處理正式環境？
A: 需要向綠界申請正式商店代號，並更新 `MerchantID`。

## 未來優化建議

1. 加入地址搜尋功能
2. 顯示門市營業時間
3. 加入門市照片
4. 支援多家超商選擇
5. 整合物流追蹤功能